<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Guestbook</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="_csrf" th:content="${_csrf.token}" />
  <meta name="_csrf_header" th:content="${_csrf.headerName}" />
  <link rel="stylesheet" th:href="@{/css/bootstrap.css}" type="text/css">
  <link rel="stylesheet" th:href="@{/css/style.css}" type="text/css">
  <link rel="icon" th:href="@{/favicon.png}" type="image/x-icon" />
  <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
</head>

<body>
  <nav class="navbar navbar-expand-lg">
    <a class="navbar-brand mr-auto" href="/">SalStocks</a>
    <a class="nav-link active" href="/">Home/Search</a>
    <a class="nav-link" href="#" sec:authorize="isAuthenticated()">Favorites</a>
    <a class="nav-link" href="#" sec:authorize="isAuthenticated()">Portfolio</a>
    <form class="nav-link" th:action="@{/logout}" method="post" sec:authorize="isAuthenticated()">
      <input type="submit" value="Logout" />
    </form>
    <a class="nav-link" href="/login" sec:authorize="!isAuthenticated()">Login/Sign Up</a>
  </nav>
  <div class="container" id="container">
    <h1 class="centered font-weight-bold">STOCK SEARCH</h1>
    <div class="text-center">
      <form class="search-bar form-inline" id="search">
        <input type="text" class="no-border" required name="stock" id="stock">
        <input type="submit" value="" class="search-icon">
      </form>
    </div>
    <div id="error" class="error-message"></div>
  </div>
  <script>
    // define DOM elements
    const errorField = $("#error")[0];
    const container = $("#container")[0];
    const stock = $("#stock")[0];

    // get CSRF Token
    const token = $("meta[name='_csrf']").attr("content");
    const header = $("meta[name='_csrf_header']").attr("content");

    // Define AJAX Callbacks
    const onSuccess = function (data, status, _) {
      console.log(status);
      console.log(data);
    }
    const onError = function (xhr, status, error) {
      errorField.innerText = `
      ${xhr.status}
      ${xhr.responseText}`;
    }

    // Set form submit 
    $("#search").submit(function () {
      // clear error message, if any
      errorField.innerHTML = "";
      $.ajax({
        "url": `${location.origin}/stock?ticker=${stock.value}`,
        "method": "GET",
        "success": onSuccess,
        "error": onError,
      });
      // disable form submit action
      return false;
    });
  </script>
</body>

</html>